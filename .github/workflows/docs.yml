name: Deploy Documentation

on:
  push:
    branches: [main, release]
  release:
    types: [published]

jobs:
  display-docs:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    - name: Generate documentation
      run: |
        echo "# Документация HelloWorldSender" > documentation.md
        echo "## Сгенерировано: $(date)" >> documentation.md
        echo "## Версия проекта" >> documentation.md
        echo "```" >> documentation.md
        python -c "from version import __version__; print(f'Версия: {__version__}')" >> documentation.md
        echo "```" >> documentation.md
        echo "## Описание проекта" >> documentation.md
        if [ -f "README.md" ]; then
          cat README.md >> documentation.md
        else
          echo "README.md не найден" >> documentation.md
        fi
        echo "## История изменений" >> documentation.md
        if [ -f "CHANGELOG.md" ]; then
          cat CHANGELOG.md >> documentation.md
        else
          echo "CHANGELOG.md не найден" >> documentation.md
        fi
        echo "## Структура проекта" >> documentation.md
        echo "\`\`\`" >> documentation.md
        find . -name "*.py" -o -name "*.md" -o -name "*.yml" | head -20 >> documentation.md
        echo "\`\`\`" >> documentation.md
        echo "Документация сгенерирована автоматически"
    
    - name: Display documentation
      run: |
        echo "=== СГЕНЕРИРОВАННАЯ ДОКУМЕНТАЦИЯ ==="
        cat documentation.md
        echo "=== КОНЕЦ ДОКУМЕНТАЦИИ ==="
    
    - name: Upload documentation
      uses: actions/upload-artifact@v4
      with:
        name: generated-docs
        path: documentation.md
        retention-days: 30
